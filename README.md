# üß† Telegram-–ë–æ—Ç —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π iiko –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞

## üìå –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞, —É–ø—Ä–æ—â–∞—è:

- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ —Ñ–∞–º–∏–ª–∏–∏;
- —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å iiko –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º;
- —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∞–∫—Ç—ã);
- —Ä–∞—Å—á—ë—Ç –∑–∞—Ä–ø–ª–∞—Ç –ø–æ —Å–º–µ–Ω–∞–º, –æ–∫–ª–∞–¥–∞–º, —á–∞—Å–∞–º –∏ –≤—ã—Ä—É—á–∫–µ.

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **async**-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Webhook –∏ Polling —Ä–µ–∂–∏–º–æ–≤.

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ bot.py                # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏ –∑–∞–ø—É—Å–∫ Dispatcher
‚îú‚îÄ‚îÄ config.py             # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram-–±–æ—Ç–∞ —á–µ—Ä–µ–∑ BOT_TOKEN
‚îú‚îÄ‚îÄ main.py               # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ polling-—Ä–µ–∂–∏–º–µ
‚îú‚îÄ‚îÄ webhook.py            # FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Webhook
‚îú‚îÄ‚îÄ states.py             # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ª–æ–≥–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
‚îú‚îÄ‚îÄ Procfile              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ Heroku / Railway
‚îú‚îÄ‚îÄ .env                  # –°–µ–∫—Ä–µ—Ç—ã: BOT_TOKEN, DATABASE_URL
‚îú‚îÄ‚îÄ requirements.txt      # –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ employees_db.py         # ORM –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ group_db.py             # ORM –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥—Ä—É–ø–ø —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ nomenclature_db.py      # ORM –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ stores_db.py            # ORM –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫–ª–∞–¥–æ–≤
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ commands.py              # /start, /cancel, /load_*
‚îÇ   ‚îú‚îÄ‚îÄ document.py              # –®–∞–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫—Ç–æ–≤ (–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ/–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ)
‚îÇ   ‚îî‚îÄ‚îÄ salary.py                # –ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∏–Ω–ª–∞–π–Ω-–∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –≤—ã–≤–æ–¥ –æ—Ç—á—ë—Ç–∞)
‚îú‚îÄ‚îÄ iiko/
‚îÇ   ‚îî‚îÄ‚îÄ iiko_auth.py             # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îú‚îÄ‚îÄ inline_calendar.py      # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–Ω–ª–∞–π–Ω-–∫–∞–ª–µ–Ω–¥–∞—Ä—è
‚îÇ   ‚îî‚îÄ‚îÄ main_keyboard.py        # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ –º–µ–Ω—é –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ cash_shift_report.py    # –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ –ø–æ —Å–º–µ–Ω–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ employees.py            # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ XML
‚îÇ   ‚îî‚îÄ‚îÄ salary_report.py        # –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ db_stores.py            # asyncpg –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ —Å–∫–ª–∞–¥–æ–≤
    ‚îú‚îÄ‚îÄ stores_kb.py            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞
    ‚îî‚îÄ‚îÄ telegram_helpers.py     # –£–º–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```

---

## üîÑ –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ —Å `/start`.
2. –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ñ–∞–º–∏–ª–∏—é –∏ —Å–≤–µ—Ä—è–µ—Ç –µ—ë —Å –±–∞–∑–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.
3. –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `telegram_id` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
4. –î–∞–ª–µ–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è:
   - üì¶ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ `/load_staff`, `/load_products`, `/load_groups`, `/load_stores`
   - üßæ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–æ–≤: –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è
   - üí∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —á–µ—Ä–µ–∑ –∏–Ω–ª–∞–π–Ω-–∫–∞–ª–µ–Ω–¥–∞—Ä—å

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```
BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
DATABASE_URL=postgresql+asyncpg://user:password@host:port/dbname
MODE=dev
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 3. –ó–∞–ø—É—Å–∫ –≤ dev-—Ä–µ–∂–∏–º–µ (polling)

```bash
python main.py
```

### 4. –ó–∞–ø—É—Å–∫ –≤ prod-—Ä–µ–∂–∏–º–µ (webhook)

```bash
uvicorn webhook:app --host 0.0.0.0 --port 8000
```

---

## üßæ –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞         | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
|-----------------|-----------------------------------------------|
| `/start`        | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ —Ñ–∞–º–∏–ª–∏–∏             |
| `/cancel`       | –û—Ç–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏ –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é      |
| `/load_staff`   | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ iiko                  |
| `/load_products`| –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã                         |
| `/load_groups`  | –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø —Ç–æ–≤–∞—Ä–æ–≤                        |
| `/load_stores`  | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫–ª–∞–¥–æ–≤                              |

---

## üìä –ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–π –º–æ–¥—É–ª—å

–ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤:

- `handlers/salary.py` ‚Äî –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç —á–µ—Ä–µ–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
- `services/salary_report.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞
- `services/cash_shift_report.py` ‚Äî –≤—ã—Ä—É—á–∫–∞ –ø–æ —Å–º–µ–Ω–∞–º
- `db/employees_db.py` ‚Äî —Å—Ç–∞–≤–∫–∏, –ø—Ä–æ—Ü–µ–Ω—Ç—ã, —Ç–∏–ø –æ–ø–ª–∞—Ç—ã

–ü–æ–¥–¥–µ—Ä–∂–∫–∞:

- –û–∫–ª–∞–¥–æ–≤ (monthly)
- –ü–æ—á–∞—Å–æ–≤–æ–π –æ–ø–ª–∞—Ç—ã
- –°–º–µ–Ω–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- –ü—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –æ—Ç –≤—ã—Ä—É—á–∫–∏

---

## üì¶ –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `handlers/document.py`:

- FSM-—à–∞–≥–∏ –ø–æ –≤—ã–±–æ—Ä—É —Å–∫–ª–∞–¥–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞/–ø—Ä–∏—ë–º–Ω–∏–∫–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–ø—Ä–æ—Å–æ–≤
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞ ‚Äî `utils/stores_kb.py`

---

## üß† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ö–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ —Å –ò–ò ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∏–Ω—å —ç—Ç–æ—Ç `README.md`, –∏ –ò–ò –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–π–º—ë—Ç –≤—Å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞.