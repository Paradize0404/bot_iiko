
## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº Ğ¸ Ğ¾Ğ±Ñ‰Ğ¸Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
from aiogram import Router, F, types
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from keyboards.main_keyboard import get_document_type_keyboard
from handlers.common import get_template_keyboard
from handlers.writeoff import start_writeoff 
from handlers.invoice import start_invoice
from config import ADMIN_IDS

## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ğ›Ğ¾Ğ³Ğ³ĞµÑ€ Ğ¸ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ´Ğ»Ñ aiogram â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
router = Router()



## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ğ¡Ñ‚Ğ°Ñ€Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@router.message(F.text == "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°")
async def choose_document_type(message: Message, state: FSMContext):
    """
    ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµĞ½Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
    """
    kb = get_document_type_keyboard()
    msg = await message.answer("Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°:", reply_markup=kb)
    await state.update_data(form_message_id=msg.message_id)



## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ğ—Ğ°Ğ¿ÑƒÑĞº FSM ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@router.callback_query(F.data == "doc:writeoff")
async def handle_writeoff(callback: types.CallbackQuery, state: FSMContext):
    """
    Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ FSM Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ° ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ
    """
    await start_writeoff(callback, state)  # ğŸ§  Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ FSM ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ




## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ğ—Ğ°Ğ¿ÑƒÑĞº FSM Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@router.callback_query(F.data == "doc:invoice")
async def handle_invoice(callback: types.CallbackQuery, state: FSMContext):
    """
    Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ FSM Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¹
    """
    await start_invoice(callback, state)



## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@router.callback_query(F.data == "doc:prep")
async def forward_to_invoice_template(callback: types.CallbackQuery, state: FSMContext):
    """
    ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµĞ½Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñƒ
    """
    user_id = callback.from_user.id

    if user_id in ADMIN_IDS:
        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="ğŸ“‹ ĞŸĞ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñƒ", callback_data="prep:by_template")],
            [InlineKeyboardButton(text="ğŸ›  Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½", callback_data="prep:create_template")]
        ])
        await callback.message.edit_text("Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¹:", reply_markup=keyboard)
        await callback.answer()
    else:
        # Ğ”Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
        from handlers.use_template import show_templates
        await show_templates(callback)





